from __future__ import print_function
import matplotlib.pyplot as plt
import numpy as np

import ekg_data
import learn_utils
from lof import LOF

# Read data file
#ekg_filename = 'a09.dat'
#ekg_data = ekg_data.read_ekg_data(ekg_filename)
#print(ekg_data.shape)

# Cutting a small piece of data
#ekg_data = ekg_data[0:1024]
window_rads = np.linspace(0, 128*np.pi, 1024)
ekg_data = np.sin(window_rads)*3+21

# Setting up window size and slide interval
segment_len = 32
slide_len = 2

# Training data segments
segments = []
for start_pos in range(0, len(ekg_data), slide_len):
    end_pos = start_pos + segment_len
    segment = np.copy(ekg_data[start_pos:end_pos]).tolist()
    if len(segment) != segment_len:
        continue
    segments.append(segment)
print("Produced %d waveform segments" % len(segments))

# LOF function call
lof = LOF(segments)

test = np.cos(window_rads)*3+21
sources = []
for start_pos in range(0, len(test), slide_len):
    end_pos = start_pos + segment_len
    source = np.copy(test[start_pos:end_pos]).tolist()
    if len(source) != segment_len:
        continue
    sources.append(source)
print("Produced %d waveform test_segments" % len(sources))
'''
sources = [
(21.0, 22.149114161585647, 23.122948340998057, 23.772958865803886, 23.999996463451158, 23.769429982920595, 23.116428852932298, 22.140598517618564, 20.99078713279872, 19.842381031503162, 18.870552192019037, 18.22353840250932, 18.00003182888955, 18.23412501787903, 18.89011059473239, 19.867927883095163, 21.018425647517937, 22.166112858145066, 23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 16.241313238875417, 18.90324912198223, 19.885012633019016),
(23.122948340998057, 23.772958865803886, 23.999996463451158, 23.769429982920595, 23.116428852932298, 22.140598517618564, 20.99078713279872, 19.842381031503162, 18.870552192019037, 18.22353840250932, 18.00003182888955, 18.23412501787903, 18.89011059473239, 19.867927883095163, 21.018425647517937, 22.166112858145066, 23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954),
(23.999996463451158, 23.769429982920595, 23.116428852932298, 22.140598517618564, 20.99078713279872, 19.842381031503162, 18.870552192019037, 18.22353840250932, 18.00003182888955, 18.23412501787903, 18.89011059473239, 19.867927883095163, 21.018425647517937, 22.166112858145066, 23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177),
(23.116428852932298, 22.140598517618564, 20.99078713279872, 19.842381031503162, 18.870552192019037, 18.22353840250932, 18.00003182888955, 18.23412501787903, 18.89011059473239, 19.867927883095163, 21.018425647517937, 22.166112858145066, 23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434),
(20.99078713279872, 19.842381031503162, 18.870552192019037, 18.22353840250932, 18.00003182888955, 18.23412501787903, 18.89011059473239, 19.867927883095163, 21.018425647517937, 22.166112858145066, 23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357),
(18.870552192019037, 18.22353840250932, 18.00003182888955, 18.23412501787903, 18.89011059473239, 19.867927883095163, 21.018425647517937, 22.166112858145066, 23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693),
(18.00003182888955, 18.23412501787903, 18.89011059473239, 19.867927883095163, 21.018425647517937, 22.166112858145066, 23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817),
(18.89011059473239, 19.867927883095163, 21.018425647517937, 22.166112858145066, 23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464),
(21.018425647517937, 22.166112858145066, 23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583),
(23.13592719258589, 23.779938144947444, 23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603),
(23.999911586695852, 23.762293896931475, 23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291),
(23.10333005967616, 22.12353503985518, 20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742),
(20.972361745933846, 19.825404249573765, 18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943),
(18.85761356629288, 18.21661152461241, 18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896),
(18.000173289259, 18.241313238875417, 18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835),
(18.90324912198223, 19.885012633019016, 21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667),
(21.036850599963763, 22.183067565339954, 23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187),
(23.14882547042889, 23.78681255627177, 23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832),
(23.999713544046344, 23.755053608718434, 23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645),
(23.09015192233933, 22.10642917889357, 20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449),
(20.95393740166895, 19.808471777009693, 18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936),
(18.844755757974006, 18.209789644691817, 18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936, 20.917094620965305, 19.774742313261743),
(18.00042791232087, 18.248605526023464, 18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936, 20.917094620965305, 19.774742313261743, 18.819284530635446, 18.196461904178214),
(18.916466745125792, 19.902139443696583, 21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936, 20.917094620965305, 19.774742313261743, 18.819284530635446, 18.196461904178214, 18.00127660383273, 18.263501194509196),
(21.05527416229159, 22.199977643586603, 23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936, 20.917094620965305, 19.774742313261743, 18.819284530635446, 18.196461904178214, 18.00127660383273, 18.263501194509196, 18.9431372816915, 19.936516661446603),
(23.161642687964342, 23.79358184045291, 23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936, 20.917094620965305, 19.774742313261743, 18.819284530635446, 18.196461904178214, 18.00127660383273, 18.263501194509196, 18.9431372816915, 19.936516661446603, 21.09211433669809, 22.233661363342073),
(23.999402342973408, 23.74770939140742, 23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936, 20.917094620965305, 19.774742313261743, 18.819284530635446, 18.196461904178214, 18.00127660383273, 18.263501194509196, 18.9431372816915, 19.936516661446603, 21.09211433669809, 22.233661363342073, 23.18703201116915, 23.8068040099281),
(23.07689493804169, 22.08928158001943, 20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936, 20.917094620965305, 19.774742313261743, 18.819284530635446, 18.196461904178214, 18.00127660383273, 18.263501194509196, 18.9431372816915, 19.936516661446603, 21.09211433669809, 22.233661363342073, 23.18703201116915, 23.8068040099281, 23.998440516783354, 23.73271028158743),
(20.93551479502697, 19.791584252555896, 18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936, 20.917094620965305, 19.774742313261743, 18.819284530635446, 18.196461904178214, 18.00127660383273, 18.263501194509196, 18.9431372816915, 19.936516661446603, 21.09211433669809, 22.233661363342073, 23.18703201116915, 23.8068040099281, 23.998440516783354, 23.73271028158743, 23.050146431896387, 22.05486375752437),
(18.831979252098492, 18.203073020089835, 18.000795688469996, 18.256001604235667, 18.92976296555366, 19.91930766905187, 21.07369563950796, 22.216842454984832, 23.174378361687356, 23.800245742132645, 23.99897799521651, 23.7402615220449, 23.063559606877465, 22.072092890092936, 20.917094620965305, 19.774742313261743, 18.819284530635446, 18.196461904178214, 18.00127660383273, 18.263501194509196, 18.9431372816915, 19.936516661446603, 21.09211433669809, 22.233661363342073, 23.18703201116915, 23.8068040099281, 23.998440516783354, 23.73271028158743, 23.050146431896387, 22.05486375752437, 20.8986775743496, 19.75794659445702)
]
'''
for instance in sources:
    value = lof.local_outlier_factor(3, instance)
    print(value)